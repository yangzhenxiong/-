# 数据库分片

## 实现方法

- 硬编码实现数据分片
- 映射表外部存储

## 挑战

- 需要大量额外的代码，处理逻辑变得复杂
- 无法执行多分片的联合查询
- 无法使用数据库事务
- 随着数据的增长，如何增加更多的服务器

## 分布式数据库中间件

- Mycat
- Amoeba/Cobar 架构
- 集群的扩容

# NoSQL

## CAP 原理

- 一致性
- 可用性
- 分区耐受性

## 最终一致性

- 根据时间戳，最后写入覆盖
- 客户端冲突解决
- 投票解决冲突（Cassandra）
- Hbase 架构

# 分布式一致 Zookeeper

- 分布式系统脑裂
- 数据库主主备份
- 分布式一致性算法 Paxos
- Zookeeper 架构
- Zab 协议
- Zookeeper 的树状记录结构
- 配置管理
- 集群管理

