# 分布式缓存架构

## 缓存

- 介于数据访问者和数据源之间的一种高速存储，当数据需要多次读取的时候，用于加速读取的速度。

- 与缓冲 Buffer 不同，缓冲是用于解决不同存储设备、不同服务之间数据传输速率不同而导致的阻塞问题，通过缓冲可以提高资源利用率。

- 缓冲数据存储结构：Hash表

- 缓冲的关键指标：命中率

- 代理缓存

- （多层）反向代理缓存

- 内容分发网络（CDN）

- 通读缓存

- 旁路缓存

- 浏览器对象缓存：本地缓存

- 本地对象缓存

  - 本地对象缓存构建分布式集群

- 远程分布式对象缓存

  MemCached 分布式对象缓存

  Redis 缓存模型：16384个桶，根据 CRC 16（Key）mod 16384的值，决定 Key 值放在哪个桶，物理节点映射到[0, 16383]slot上，集群负责 slot 与服务器的映射关系，所有节点之间互相连接，客户端只需要与其中一个节点连接

  分布式对象缓存的一致性 Hash 算法：Hash 环+虚拟节点，解决缓存分配不均匀，增减节点时，缓存大部分失效问题。缓存失效会引起：缓存穿透、服务雪崩

# 消息队列与异步架构

同步调用线程会阻塞，通过消息队列，转换为异步调用，线程不阻塞，提高系统性能、解耦。系统具有更好的伸缩性、削峰填谷、失败隔离和自我修复

## 消息队列模型

- 点对点模型
- 发布订阅模型

## 主要 MQ 产品

- RabbitMQ: Erlang
- ActiveMQ: Java
- RocketMQ: 阿里 Java
- Kafka: LinkedIn Scala

# 负责均衡架构

- HTTP 重定向负载
- DNS 负载均衡
- 反向代理负载均衡
- IP 负载均衡
- 数据链路层负载均衡：三角形，请求时经过负载均衡服务器，返回时服务器直接返回客户端，不经过负载均衡服务器。

## 负载均衡算法

- 轮询
- 加权轮询
- 随机
- 最少连接
- 源地址散列

## 应用服务器集群的 Session 管理

- Session 复制: 已经淘汰，服务器本身无法处理过多的请求，还要保留 session 值，是不切实际的。
- Session 绑定: 这种架构也不完美，服务器宕机时，失效的 session 如何处理。
- 利用 Cookie 记录 session
- Session 服务器

# 分布式数据库

- MySQL 复制
- 主从复制
- 一主多从复制
- 主主复制

